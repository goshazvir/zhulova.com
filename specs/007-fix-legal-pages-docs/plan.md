# Implementation Plan: Fix Legal Pages Documentation Alignment

**Branch**: `007-fix-legal-pages-docs` | **Date**: 2025-11-23 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/007-fix-legal-pages-docs/spec.md`

## Summary

Align feature 004-legal-pages specification documents with actual implementation by resolving 14 identified inconsistencies across critical, high, and medium severity levels. Update spec.md, plan.md, tasks.md, and research.md to accurately document the implemented 10-section conversational format for legal pages, fix constitution compliance claims regarding hybrid mode usage, remove duplicate requirements, replace ambiguous criteria with measurable standards, and ensure all documentation claims are verifiable against source code. This is documentation-only work with zero code changes - all edits update spec files to reflect existing behavior in src/pages/privacy-policy.astro and src/pages/terms.astro.

**Technical Approach**: Direct markdown file editing with automated validation (search verification, requirement mapping, code cross-referencing). No research phase needed - all 14 issues already analyzed with specific remediation paths documented in spec.md.

## Technical Context

**Language/Version**: Markdown (GitHub-flavored), English language
**Primary Dependencies**: None (plain text editing)
**Storage**: Git version control (files in `specs/004-legal-pages/`)
**Testing**: Manual verification (grep searches, markdown link validation, code file cross-reference)
**Target Platform**: GitHub repository (web markdown viewer)
**Project Type**: Documentation-only feature (no source code changes)
**Performance Goals**: N/A (documentation editing has negligible performance impact)
**Constraints**:
- MUST NOT modify source code in src/pages/privacy-policy.astro, src/pages/terms.astro, or components
- MUST preserve existing template structure from Spec-Kit
- MUST reference actual code line numbers for verification claims
- All cross-document links MUST work in GitHub markdown preview
- Single source of truth: implementation is authoritative, documentation conforms to code

**Scale/Scope**:
- 4 documentation files to update (spec.md, plan.md, tasks.md, research.md)
- 21 functional requirement fixes (FR-001 to FR-021)
- ~200-300 lines of changes across all files
- ~2-3 hours estimated completion time

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Static-First Delivery âœ… N/A

- âœ… No impact on static/hybrid architecture (documentation-only)
- âœ… No server-side execution changes
- âœ… No frontend component changes
- âœ… Legal pages remain pre-rendered static HTML (implementation already correct)

**Note**: This feature FIXES documentation that incorrectly claimed `output: 'static'` when codebase uses `output: 'hybrid'`. The fix acknowledges hybrid mode is used exclusively for `/api/*` serverless functions (feature 005-fix-consultation-api), while all pages including legal pages remain statically generated.

### II. Performance-First Development âœ… N/A

- âœ… No bundle size impact (documentation not deployed)
- âœ… No runtime performance impact
- âœ… No Core Web Vitals changes
- âœ… Documentation updates have zero effect on page load times

### III. Simplicity Over Tooling âœ… PASS

- âœ… No new dependencies added
- âœ… Uses existing Git version control
- âœ… Plain markdown text editing
- âœ… Manual validation (grep, GitHub preview)
- âœ… No build tools or automation scripts required

### IV. Accessibility & SEO âœ… N/A

- âœ… No UI changes
- âœ… Documentation not user-facing (internal developer docs)
- âœ… GitHub markdown is inherently accessible

### V. TypeScript Strict Mode âœ… N/A

- âœ… No TypeScript code changes
- âœ… No validation schema updates
- âœ… Documentation edits don't affect type safety

### VI. Design System Consistency âœ… N/A

- âœ… No UI component changes
- âœ… No styling changes
- âœ… Documentation updates preserve markdown formatting standards

**Overall Status**: âœ… **ALL GATES PASSED** â€” No violations, documentation-only changes have zero impact on constitution principles.

## Project Structure

### Documentation (this feature)

```text
specs/007-fix-legal-pages-docs/
â”œâ”€â”€ spec.md              # âœ… COMPLETE - Feature specification
â”œâ”€â”€ plan.md              # This file (generated by /speckit.plan)
â”œâ”€â”€ research.md          # N/A - No research needed (skipping Phase 0)
â”œâ”€â”€ data-model.md        # N/A - No data model (documentation-only)
â”œâ”€â”€ quickstart.md        # Phase 1 output - Verification guide
â”œâ”€â”€ contracts/           # N/A - No API contracts
â””â”€â”€ checklists/
    â””â”€â”€ requirements.md  # âœ… COMPLETE - Quality validation
```

### Target Files (to be updated)

**Documentation Files** (specs/004-legal-pages/):
```text
specs/004-legal-pages/
â”œâ”€â”€ spec.md                     # Update: section counts, FR-024, FR-005/FR-010, status, edge cases
â”œâ”€â”€ plan.md                     # Update: constitution check (hybrid mode clarification)
â”œâ”€â”€ tasks.md                    # Update: T003/T010 TOC status, terminology standardization
â””â”€â”€ research.md                 # Update: document actual 10-section structure with rationale
```

**Reference Files** (read-only, for verification):
```text
src/pages/
â”œâ”€â”€ privacy-policy.astro        # Reference: verify 10 sections, no TOC
â””â”€â”€ terms.astro                 # Reference: verify 10 sections, no TOC

src/components/layout/
â”œâ”€â”€ Footer.astro                # Reference: verify variant='legal' behavior
â””â”€â”€ Header.astro                # Reference: verify variant='legal' behavior

astro.config.mjs                # Reference: verify output: 'hybrid' configuration

.specify/memory/constitution.md # Reference: verify principle I rules
```

**Structure Decision**: This is a documentation-only feature that updates existing spec documents in `specs/004-legal-pages/`. No source code structure changes. The feature's own spec (007) contains planning documents, while edits target 004 spec files to align them with actual implementation.

## Complexity Tracking

> **No violations detected** â€” All constitution principles satisfied by documentation-only changes. This section is intentionally empty.

## Phase 0: Research & Unknowns

**Status**: âœ… **SKIPPED** â€” No research needed

**Rationale**: All 14 inconsistencies already analyzed via `/speckit.analyze` command with specific remediation paths documented. Implementation code (privacy-policy.astro, terms.astro) cross-referenced. Analysis report provides:
- C1-C3: Critical issue descriptions + recommended fixes
- H1-H5: High priority issue descriptions + recommended fixes
- M1-M4: Medium priority issue descriptions + recommended fixes
- L1-L2: Low priority issue descriptions + recommended fixes

No unknowns remain - this is execution-only work (update markdown files to match code reality).

**Skipping research.md generation**: Not applicable for documentation alignment feature.

---

## Phase 1: Design Artifacts

### 1.1 Data Model

**Status**: âœ… **N/A** â€” No data entities (documentation-only feature)

**Rationale**: This feature edits markdown files, not database schemas or API contracts. No data model needed.

Key entities are conceptual (Documentation Artifact, Documentation Issue, Functional Requirement) and documented in spec.md for clarity, but don't require formal data-model.md.

**Skipping data-model.md generation**: Not applicable for documentation-only feature.

### 1.2 API Contracts

**Status**: âœ… **N/A** â€” No API endpoints (documentation-only feature)

**Rationale**: No APIs created or modified. Feature updates spec files that document existing legal pages implementation. No OpenAPI contracts needed.

**Skipping contracts/ generation**: Not applicable for documentation-only feature.

### 1.3 Quickstart Guide

**Task**: Create verification guide for documentation changes

**Content**:

1. **Prerequisites**: Git branch checked out (`007-fix-legal-pages-docs`), spec documents accessible in `specs/004-legal-pages/`
2. **Verification Steps**:
   - Constitution check: Verify plan.md states "Hybrid mode permitted exclusively for /api/*" and references actual astro.config.mjs
   - Section count validation: Count sections in privacy-policy.astro and terms.astro (should be 10 each), verify spec.md FR-003/FR-008 match
   - TOC verification: Search privacy-policy.astro for table of contents or anchor links, verify spec.md FR-024 either documents implementation OR moved to "Out of Scope"
   - Duplicate check: Search spec.md for FR-004/FR-009 and FR-005/FR-010, verify consolidated (not duplicated)
   - Ambiguity check: Search spec.md for "minimal luxury aesthetic", verify replaced with measurable criteria (typography, colors, spacing)
   - Link validation: Test all markdown links (data-model.md references, quickstart.md links) in GitHub preview
3. **Manual Review Checklist**:
   - [ ] C1: plan.md constitution check acknowledges hybrid mode for API routes
   - [ ] C2: FR-024 removed from spec.md OR TOC implemented in code
   - [ ] C3: FR-003 states "10 conversational sections" not "16 mandatory sections"
   - [ ] H1: spec.md status shows "Completed (2025-11-17)" not "Draft"
   - [ ] H2: FR-005/FR-010 replaced with measurable typography/color criteria
   - [ ] M1: FR-004/FR-009 consolidated (no duplication)
   - [ ] M2: FR-025 added documenting Header/Footer variant behavior
4. **Final Validation**: Run verification commands to confirm alignment:
   ```bash
   # Count sections in implementation
   grep -c "^      <section" src/pages/privacy-policy.astro
   # Expected: 10

   # Verify spec.md section count claim
   grep "10 conversational sections" specs/004-legal-pages/spec.md
   # Expected: Match found in FR-003

   # Verify no duplicate requirements
   grep -c "responsive on mobile (375px)" specs/004-legal-pages/spec.md
   # Expected: 1 (not 2)

   # Verify measurable aesthetic criteria
   grep "Playfair Display headings" specs/004-legal-pages/spec.md
   # Expected: Match found in FR-005
   ```

**Output**: `quickstart.md`

### 1.4 Agent Context Update

**Task**: Run `.specify/scripts/bash/update-agent-context.sh claude`

**Purpose**: Update `.claude/` agent context with documentation alignment patterns

**New Context to Add**:
- Documentation-first workflow (analyze implementation â†’ update specs to match)
- Verification approach (grep searches, markdown link checking, code cross-reference)
- Single source of truth pattern (implementation is authoritative)
- Constitution exception handling (hybrid mode for API routes only)

**Output**: Updated `.claude/` context file (CLAUDE.md Active Technologies section)

---

## Implementation Phases

### Phase 0: Research âœ… SKIPPED

**Status**: Not applicable â€” all 14 issues already analyzed with remediation paths

### Phase 1: Design & Documentation âœ… READY

**Prerequisites**: None (skipping research phase)

**Deliverables**:
1. âœ… Skip data-model.md (N/A)
2. âœ… Skip contracts/ (N/A)
3. Generate quickstart.md (verification guide)
4. Update agent context

**Execution**:
- Generate `quickstart.md` with verification steps and validation commands
- Run `update-agent-context.sh claude` to add documentation patterns

### Phase 2: Task Breakdown (via `/speckit.tasks`)

**Input**: This plan.md + spec.md
**Output**: tasks.md with actionable steps for 21 functional requirement fixes (FR-001 to FR-021)
**Note**: NOT generated by `/speckit.plan` â€” separate command

Expected task structure:
- **Phase 1**: Setup (verify branch, access to 004 spec files)
- **Phase 2**: Critical Fixes (FR-001 to FR-006) - constitution, TOC, section counts
- **Phase 3**: High Priority Fixes (FR-007 to FR-011) - status, measurable criteria, monitoring
- **Phase 4**: Medium Priority Fixes (FR-012 to FR-015) - duplicates, terminology, validation
- **Phase 5**: Low Priority Fixes (FR-016 to FR-017) - wording consistency
- **Phase 6**: Coverage & Validation (FR-018 to FR-021) - requirement mapping, verification
- **Phase 7**: Final Verification (run quickstart.md validation commands)

---

## Implementation Checklist

**Before coding (Phase 0-1):**
- [x] Constitution Check passed
- [x] Feature specification complete (`spec.md`)
- [x] Research complete (N/A - skipped)
- [x] Data model documented (N/A - skipped)
- [x] API contracts generated (N/A - skipped)
- [ ] Quickstart guide created (`quickstart.md`)
- [ ] Agent context updated

**After coding (Phase 2 - via `/speckit.tasks`):**
- [ ] C1-C3: All critical issues resolved (constitution, TOC, section count)
- [ ] H1-H5: All high priority issues resolved (status, measurable criteria, edge cases)
- [ ] M1-M4: All medium priority issues resolved (duplicates, terminology, validation)
- [ ] L1-L2: All low priority issues resolved (wording consistency)
- [ ] FR-018 to FR-021: Coverage and validation complete
- [ ] All verification commands passing (quickstart.md validation section)
- [ ] Markdown links tested in GitHub preview

---

## Next Steps

1. **Generate quickstart.md**: Verification guide with validation commands
2. **Update Agent Context**: Run `update-agent-context.sh claude`
3. **Re-validate Constitution**: Confirm no violations introduced (expected: none)
4. **Ready for `/speckit.tasks`**: Generate actionable task list for 21 functional requirement fixes

**Command to Continue**:
```bash
/speckit.tasks  # Generate task breakdown for documentation updates
```

---

**Status**: ðŸŸ¢ **Phase 1 Ready** â€” No research needed, proceed to task generation
